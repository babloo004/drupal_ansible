- name: "Setting Drupal in ubuntu"
  hosts: ubuntu
  become: yes
  vars_files:
    - ../vars/installs.yaml
    - ../vars/services.yaml
    - ../vars/mariaDB.yaml

  pre_tasks:

    - name: "Updating cache"
      apt:
        update_cache: yes
        cache_valid_time: 3600

  tasks:

    - name: "file: Creating drupal directory"
      file:
        path: /drupal/
        state: directory

    - name: "get_url: Downloading drupal"
      get_url:
        url: https://www.drupal.org/download-latest/tar.gz
        dest: /drupal/drupal.tar.gz

    - name: "file: creating drupal directory in /var/www/html/"
      file:
        path: /var/www/html/drupal/
        state: directory

    - name: "unarchive: unarchiving tar files"
      unarchive:
        src: /drupal/drupal.tar.gz
        dest: /var/www/html/drupal/
        remote_src: yes

    - name: "file: changing access to /var/www/html/drupal/"
      file:
        path: /var/www/html/drupal/
        owner: "www-data"
        group: "www-data"
        state: directory
        recurse: yes
        mode: '755'
